<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>USB IR HID Device: main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>main.c File Reference</h1><code>#include &lt;avr/io.h&gt;</code><br/>
<code>#include &lt;avr/interrupt.h&gt;</code><br/>
<code>#include &lt;avr/pgmspace.h&gt;</code><br/>
<code>#include &lt;avr/eeprom.h&gt;</code><br/>
<code>#include &lt;avr/wdt.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="usbdrv_8h_source.html">usbdrv.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="irrx_8h_source.html">irrx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="oddebug_8h_source.html">oddebug.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="uart__io_8h_source.html">uart_io.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="main_8c_source.html">ir_keyboard_2.hid.h</a>&quot;</code><br/>

<p><a href="main_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvirtual__keyboard__buffer__t.html">virtual_keyboard_buffer_t</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a192d8ca52a5971257154076e5d0321b4">elements_of</a>(array)&nbsp;&nbsp;&nbsp;(sizeof(array) / sizeof(array[0]))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a5bbf7f30820f080616be89266fbcf129">LED_RED_CHANGE</a>()&nbsp;&nbsp;&nbsp;PORTB ^= _BV(PB2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a95ee068e1e61fe45d00e66a1bfee85d1">LED_RED_ON</a>()&nbsp;&nbsp;&nbsp;PORTB |= _BV(PB2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a327a94a460a470f29977db858d8074e1">LED_RED_OFF</a>()&nbsp;&nbsp;&nbsp;PORTB &amp;= ~_BV(PB2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a7e787ad0abe6e286eedf5f5ef2f2197b">LED_RED_INIT</a>()&nbsp;&nbsp;&nbsp;DDRB |= _BV(PB2) | _BV(PB1);PORTB &amp;= ~_BV(PB1);LED_RED_OFF()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ad063cbad772522336818a49a2e9e5d9f">LED_GREEN_CHANGE</a>()&nbsp;&nbsp;&nbsp;PORTC ^= _BV(PC3)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a5d5e08cf941c440ad0e802eee233e3ff">LED_GREEN_ON</a>()&nbsp;&nbsp;&nbsp;PORTC |= _BV(PC3)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a644339948c77e66e185ba6fc33501f39">LED_GREEN_OFF</a>()&nbsp;&nbsp;&nbsp;PORTC &amp;= ~_BV(PC3)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a80ba70ad8af2e269976f4460a3414dd9">LED_GREEN_INIT</a>()&nbsp;&nbsp;&nbsp;PORTC |= _BV(PC3);LED_RED_OFF()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a023283967eacb7889ae3819ba47cb2f8">SWITCH_PGM_IS_PRESSED</a>()&nbsp;&nbsp;&nbsp;bit_is_clear(PINC,4)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a550fbfbb0db187844ade560690c7fa5f">SWITCH_PGM_INIT</a>()&nbsp;&nbsp;&nbsp;DDRC &amp;=~_BV(PC4);PORTC|=_BV(PC4)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#aa7d921cda07f5efb9d08bbd36ee22f1b">STATIC_ASSERT</a>(expr)&nbsp;&nbsp;&nbsp;extern char static_assert[ (!!(expr))*2 - 1]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#aa02590a267536e231cd908ae02f29228">LEFT_SHIFT_BIT</a>&nbsp;&nbsp;&nbsp;0x80</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a4946baeabe139cefb48abe86ae00bda4">USB_HID_KEY_a_A</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#acea49a32167a274b606539680c275ee2">USB_HID_KEY_0</a>&nbsp;&nbsp;&nbsp;0x27</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a57d866a5f430ca81cf66b77c45934c91">USB_HID_KEY_1</a>&nbsp;&nbsp;&nbsp;0x1E</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a05a87311083faadbeb4a50aae31295bb">USB_HID_KEY_RETURN</a>&nbsp;&nbsp;&nbsp;0x28</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#adf8627e6162e1db44517c37a122f0045">USB_HID_KEY_SPACEBAR</a>&nbsp;&nbsp;&nbsp;0x2C</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a094ee1e9174dc1a90485724bec7aadcb">USB_HID_KEY_DOT</a>&nbsp;&nbsp;&nbsp;0x37</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a53f3aca9a397da6b9007e082970500ef">USB_HID_KEY_COMMA</a>&nbsp;&nbsp;&nbsp;0x36</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#af4004f840b21ad09c09efbb25ccfbf1c">NUM_HARDWARE_KEYS</a>&nbsp;&nbsp;&nbsp;17</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a9a8c7403a867e0c9543467ee8754050d">NUM_KEYS</a>&nbsp;&nbsp;&nbsp;(NUM_HARDWARE_KEYS + NUM_IR_KEYS)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ab44962ccd116ade949cc9e1b0909438c">NUM_IR_KEYS</a>&nbsp;&nbsp;&nbsp;elements_of(button_labels)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a3d6b7ac1aa6b2d0f17ec2bf1b5eb580c">ReportDescriptor</a>&nbsp;&nbsp;&nbsp;usbHidReportDescriptor</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ae10e3fa5f0978259fd36da175bca3c90">IR_TIMER_TIMEOUT</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a950e6c73a7a60c02d5ddf48d538ca2c1">BLINK_TIMER_TIMEOUT</a>&nbsp;&nbsp;&nbsp;30</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="main_8c.html#abc6126af1d45847bc59afa0aa3216b04abb79a6c34b3135862fdfb5192a9e1591">ProgramingMode_Not</a> =  0, 
<a class="el" href="main_8c.html#abc6126af1d45847bc59afa0aa3216b04af27abc9ca222c960254b211d99461e2b">ProgramingMode_LAST</a> =  NUM_IR_KEYS
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384e">report_id_t</a> { <a class="el" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384ea5ccd40b7ebdad0fa141830e03d29dd46">report_id_none</a> =  0, 
<a class="el" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384eaa1297ee64a181eef334e50aaa88e8a5a">report_id_irremote</a> =  1, 
<a class="el" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384eaf94c3c43a4d7295e2a888777fcfc4c87">report_id_virtualkeyboard</a> =  2
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#af37eb5fa0cb81fc3eadda2e452573c58">STATIC_ASSERT</a> (sizeof(virtual_keyboard_buffer.data)==128||sizeof(virtual_keyboard_buffer.data)==256||sizeof(virtual_keyboard_buffer.data)==64)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="main_8c.html#a4bc2493b9488cbfb5bf35651b8f5ccee">PROGMEM</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ab22a701c31350c87bafb03abccd8c2f0">STATIC_ASSERT</a> (sizeof(usbHidReportDescriptor)==USB_CFG_HID_REPORT_DESCRIPTOR_LENGTH)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uchar&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ae6f351eca7bf6fb1251f9a478cbae2b0">usbFunctionSetup</a> (uchar data[8])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char label00[]&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a4bc2493b9488cbfb5bf35651b8f5ccee">PROGMEM</a> = &quot;Press button\n&quot;</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a950e6c73a7a60c02d5ddf48d538ca2c1"></a><!-- doxytag: member="main.c::BLINK_TIMER_TIMEOUT" ref="a950e6c73a7a60c02d5ddf48d538ca2c1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BLINK_TIMER_TIMEOUT&nbsp;&nbsp;&nbsp;30</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00499">499</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00501">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a192d8ca52a5971257154076e5d0321b4"></a><!-- doxytag: member="main.c::elements_of" ref="a192d8ca52a5971257154076e5d0321b4" args="(array)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define elements_of</td>
          <td>(</td>
          <td class="paramtype">array&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(sizeof(array) / sizeof(array[0]))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00133">133</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae10e3fa5f0978259fd36da175bca3c90"></a><!-- doxytag: member="main.c::IR_TIMER_TIMEOUT" ref="ae10e3fa5f0978259fd36da175bca3c90" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IR_TIMER_TIMEOUT&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00498">498</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad063cbad772522336818a49a2e9e5d9f"></a><!-- doxytag: member="main.c::LED_GREEN_CHANGE" ref="ad063cbad772522336818a49a2e9e5d9f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_GREEN_CHANGE</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;PORTC ^= _BV(PC3)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00140">140</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a80ba70ad8af2e269976f4460a3414dd9"></a><!-- doxytag: member="main.c::LED_GREEN_INIT" ref="a80ba70ad8af2e269976f4460a3414dd9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_GREEN_INIT</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;PORTC |= _BV(PC3);LED_RED_OFF()</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00143">143</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00501">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a644339948c77e66e185ba6fc33501f39"></a><!-- doxytag: member="main.c::LED_GREEN_OFF" ref="a644339948c77e66e185ba6fc33501f39" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_GREEN_OFF</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;PORTC &amp;= ~_BV(PC3)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00142">142</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00501">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a5d5e08cf941c440ad0e802eee233e3ff"></a><!-- doxytag: member="main.c::LED_GREEN_ON" ref="a5d5e08cf941c440ad0e802eee233e3ff" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_GREEN_ON</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;PORTC |= _BV(PC3)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00141">141</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5bbf7f30820f080616be89266fbcf129"></a><!-- doxytag: member="main.c::LED_RED_CHANGE" ref="a5bbf7f30820f080616be89266fbcf129" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_RED_CHANGE</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;PORTB ^= _BV(PB2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00135">135</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00501">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a7e787ad0abe6e286eedf5f5ef2f2197b"></a><!-- doxytag: member="main.c::LED_RED_INIT" ref="a7e787ad0abe6e286eedf5f5ef2f2197b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_RED_INIT</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;DDRB |= _BV(PB2) | _BV(PB1);PORTB &amp;= ~_BV(PB1);LED_RED_OFF()</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00138">138</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00501">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a327a94a460a470f29977db858d8074e1"></a><!-- doxytag: member="main.c::LED_RED_OFF" ref="a327a94a460a470f29977db858d8074e1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_RED_OFF</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;PORTB &amp;= ~_BV(PB2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00137">137</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00501">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a95ee068e1e61fe45d00e66a1bfee85d1"></a><!-- doxytag: member="main.c::LED_RED_ON" ref="a95ee068e1e61fe45d00e66a1bfee85d1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_RED_ON</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;PORTB |= _BV(PB2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00136">136</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00501">main()</a>.</p>

</div>
</div>
<a class="anchor" id="aa02590a267536e231cd908ae02f29228"></a><!-- doxytag: member="main.c::LEFT_SHIFT_BIT" ref="aa02590a267536e231cd908ae02f29228" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LEFT_SHIFT_BIT&nbsp;&nbsp;&nbsp;0x80</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00208">208</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="af4004f840b21ad09c09efbb25ccfbf1c"></a><!-- doxytag: member="main.c::NUM_HARDWARE_KEYS" ref="af4004f840b21ad09c09efbb25ccfbf1c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_HARDWARE_KEYS&nbsp;&nbsp;&nbsp;17</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00322">322</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab44962ccd116ade949cc9e1b0909438c"></a><!-- doxytag: member="main.c::NUM_IR_KEYS" ref="ab44962ccd116ade949cc9e1b0909438c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_IR_KEYS&nbsp;&nbsp;&nbsp;elements_of(button_labels)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00392">392</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9a8c7403a867e0c9543467ee8754050d"></a><!-- doxytag: member="main.c::NUM_KEYS" ref="a9a8c7403a867e0c9543467ee8754050d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_KEYS&nbsp;&nbsp;&nbsp;(NUM_HARDWARE_KEYS + NUM_IR_KEYS)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00324">324</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3d6b7ac1aa6b2d0f17ec2bf1b5eb580c"></a><!-- doxytag: member="main.c::ReportDescriptor" ref="a3d6b7ac1aa6b2d0f17ec2bf1b5eb580c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="ir__keyboard__2_8hid_8h.html#a9d7515f138f0992b0161c9be3456d7e3">ReportDescriptor</a>&nbsp;&nbsp;&nbsp;usbHidReportDescriptor</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The 2 byte report looks like this:</p>
<p>------------------------------------------------------------------------------------------ | Shift 0/1 | Keyboard (0-127) | IR consumer code (0-0xFF) | ------------------------------------------------------------------------------------------ </p>

<p>Definition at line <a class="el" href="main_8c_source.html#l00430">430</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa7d921cda07f5efb9d08bbd36ee22f1b"></a><!-- doxytag: member="main.c::STATIC_ASSERT" ref="aa7d921cda07f5efb9d08bbd36ee22f1b" args="(expr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATIC_ASSERT</td>
          <td>(</td>
          <td class="paramtype">expr&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;extern char static_assert[ (!!(expr))*2 - 1]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00151">151</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a550fbfbb0db187844ade560690c7fa5f"></a><!-- doxytag: member="main.c::SWITCH_PGM_INIT" ref="a550fbfbb0db187844ade560690c7fa5f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SWITCH_PGM_INIT</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;DDRC &amp;=~_BV(PC4);PORTC|=_BV(PC4)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00146">146</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00501">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a023283967eacb7889ae3819ba47cb2f8"></a><!-- doxytag: member="main.c::SWITCH_PGM_IS_PRESSED" ref="a023283967eacb7889ae3819ba47cb2f8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SWITCH_PGM_IS_PRESSED</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;bit_is_clear(PINC,4)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00145">145</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00501">main()</a>.</p>

</div>
</div>
<a class="anchor" id="acea49a32167a274b606539680c275ee2"></a><!-- doxytag: member="main.c::USB_HID_KEY_0" ref="acea49a32167a274b606539680c275ee2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USB_HID_KEY_0&nbsp;&nbsp;&nbsp;0x27</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00211">211</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a57d866a5f430ca81cf66b77c45934c91"></a><!-- doxytag: member="main.c::USB_HID_KEY_1" ref="a57d866a5f430ca81cf66b77c45934c91" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USB_HID_KEY_1&nbsp;&nbsp;&nbsp;0x1E</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00212">212</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4946baeabe139cefb48abe86ae00bda4"></a><!-- doxytag: member="main.c::USB_HID_KEY_a_A" ref="a4946baeabe139cefb48abe86ae00bda4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USB_HID_KEY_a_A&nbsp;&nbsp;&nbsp;0x04</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00210">210</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a53f3aca9a397da6b9007e082970500ef"></a><!-- doxytag: member="main.c::USB_HID_KEY_COMMA" ref="a53f3aca9a397da6b9007e082970500ef" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USB_HID_KEY_COMMA&nbsp;&nbsp;&nbsp;0x36</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00216">216</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a094ee1e9174dc1a90485724bec7aadcb"></a><!-- doxytag: member="main.c::USB_HID_KEY_DOT" ref="a094ee1e9174dc1a90485724bec7aadcb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USB_HID_KEY_DOT&nbsp;&nbsp;&nbsp;0x37</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00215">215</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a05a87311083faadbeb4a50aae31295bb"></a><!-- doxytag: member="main.c::USB_HID_KEY_RETURN" ref="a05a87311083faadbeb4a50aae31295bb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USB_HID_KEY_RETURN&nbsp;&nbsp;&nbsp;0x28</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00213">213</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="adf8627e6162e1db44517c37a122f0045"></a><!-- doxytag: member="main.c::USB_HID_KEY_SPACEBAR" ref="adf8627e6162e1db44517c37a122f0045" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USB_HID_KEY_SPACEBAR&nbsp;&nbsp;&nbsp;0x2C</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00214">214</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04"></a><!-- doxytag: member="main.c::@3" ref="abc6126af1d45847bc59afa0aa3216b04" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04abb79a6c34b3135862fdfb5192a9e1591"></a><!-- doxytag: member="ProgramingMode_Not" ref="abc6126af1d45847bc59afa0aa3216b04abb79a6c34b3135862fdfb5192a9e1591" args="" -->ProgramingMode_Not</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04af27abc9ca222c960254b211d99461e2b"></a><!-- doxytag: member="ProgramingMode_LAST" ref="abc6126af1d45847bc59afa0aa3216b04af27abc9ca222c960254b211d99461e2b" args="" -->ProgramingMode_LAST</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="main_8c_source.html#l00415">415</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00416"></a>00416 {
<a name="l00417"></a>00417   <a class="code" href="main_8c.html#abc6126af1d45847bc59afa0aa3216b04abb79a6c34b3135862fdfb5192a9e1591">ProgramingMode_Not</a> = 0,
<a name="l00418"></a>00418   <a class="code" href="main_8c.html#abc6126af1d45847bc59afa0aa3216b04af27abc9ca222c960254b211d99461e2b">ProgramingMode_LAST</a> = <a class="code" href="main_8c.html#ab44962ccd116ade949cc9e1b0909438c">NUM_IR_KEYS</a>
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="adc4a49de71d98fba3ecc94fb4023384e"></a><!-- doxytag: member="main.c::report_id_t" ref="adc4a49de71d98fba3ecc94fb4023384e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384e">report_id_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="adc4a49de71d98fba3ecc94fb4023384ea5ccd40b7ebdad0fa141830e03d29dd46"></a><!-- doxytag: member="report_id_none" ref="adc4a49de71d98fba3ecc94fb4023384ea5ccd40b7ebdad0fa141830e03d29dd46" args="" -->report_id_none</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="adc4a49de71d98fba3ecc94fb4023384eaa1297ee64a181eef334e50aaa88e8a5a"></a><!-- doxytag: member="report_id_irremote" ref="adc4a49de71d98fba3ecc94fb4023384eaa1297ee64a181eef334e50aaa88e8a5a" args="" -->report_id_irremote</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="adc4a49de71d98fba3ecc94fb4023384eaf94c3c43a4d7295e2a888777fcfc4c87"></a><!-- doxytag: member="report_id_virtualkeyboard" ref="adc4a49de71d98fba3ecc94fb4023384eaf94c3c43a4d7295e2a888777fcfc4c87" args="" -->report_id_virtualkeyboard</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="main_8c_source.html#l00445">445</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00446"></a>00446 {
<a name="l00447"></a>00447   <a class="code" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384ea5ccd40b7ebdad0fa141830e03d29dd46">report_id_none</a> = 0,
<a name="l00448"></a>00448   <a class="code" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384eaa1297ee64a181eef334e50aaa88e8a5a">report_id_irremote</a> = 1,
<a name="l00449"></a>00449   <a class="code" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384eaf94c3c43a4d7295e2a888777fcfc4c87">report_id_virtualkeyboard</a> = 2
<a name="l00450"></a>00450 } <a class="code" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384e">report_id_t</a>;
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a840291bc02cba5474a4cb46a9b9566fe"></a><!-- doxytag: member="main.c::main" ref="a840291bc02cba5474a4cb46a9b9566fe" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00501">501</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00502"></a>00502 {
<a name="l00503"></a>00503   <a class="code" href="oddebug_8h.html#aa8ddf20cdd716b652e76e23e5e700893">uchar</a> key = 0;
<a name="l00504"></a>00504   <a class="code" href="oddebug_8h.html#aa8ddf20cdd716b652e76e23e5e700893">uchar</a> lastKey = 0;
<a name="l00505"></a>00505   <a class="code" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384e">report_id_t</a> keyDidChange = <a class="code" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384ea5ccd40b7ebdad0fa141830e03d29dd46">report_id_none</a>;
<a name="l00506"></a>00506   <a class="code" href="oddebug_8h.html#aa8ddf20cdd716b652e76e23e5e700893">uchar</a> idleCounter = 0;
<a name="l00507"></a>00507   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> virtual_keyboard_timer = 0;
<a name="l00508"></a>00508   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ir_timer=0;
<a name="l00509"></a>00509   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> programming_mode_type = 0;
<a name="l00510"></a>00510   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> blink_timer=0;
<a name="l00511"></a>00511   <a class="code" href="irrx_8h.html#a61660383bded461be19a268349e08fce">irrx_code_t</a> last_ir_code = 0;
<a name="l00512"></a>00512   <a class="code" href="usbdrv_8h.html#a82287e0a9f6403a674aae635f4c9ce37">usbDeviceDisconnect</a>();
<a name="l00513"></a>00513   wdt_enable(WDTO_2S);
<a name="l00514"></a>00514     hardwareInit();<a class="code" href="oddebug_8h.html#a76be8d89e4e969ce40a7441dd4d99e80">odDebugInit</a>();
<a name="l00515"></a>00515   <a class="code" href="usbdrv_8c.html#a5672a0c07f0f8e93bde4579d278e6307">usbInit</a>();
<a name="l00516"></a>00516   <a class="code" href="irrx_8h.html#a67846545c3fb744f6106295133d44586">irrx_init</a>();
<a name="l00517"></a>00517   <a class="code" href="irrx_8h.html#acefc681e50139ef6fecefc69f99644d8">irrx_power_on</a>();
<a name="l00518"></a>00518   <a class="code" href="main_8c.html#a7e787ad0abe6e286eedf5f5ef2f2197b">LED_RED_INIT</a>();
<a name="l00519"></a>00519   <a class="code" href="main_8c.html#a80ba70ad8af2e269976f4460a3414dd9">LED_GREEN_INIT</a>();
<a name="l00520"></a>00520   <a class="code" href="main_8c.html#a550fbfbb0db187844ade560690c7fa5f">SWITCH_PGM_INIT</a>();
<a name="l00521"></a>00521   sei();
<a name="l00522"></a>00522   <a class="code" href="oddebug_8h.html#a1b3ae5f24b3863d451c3648fa2ff57be">DBG1</a>(0x00, 0, 0);
<a name="l00523"></a>00523   eeprom_read_block(&amp;ir_codes, 0, <span class="keyword">sizeof</span>(ir_codes));
<a name="l00524"></a>00524 
<a name="l00525"></a>00525   stdout = &amp;virtual_keyboard_file_io;
<a name="l00526"></a>00526   <a class="code" href="uart__io_8c.html#ad3958bec837802b46366b1354c8c666c">uart_io_init</a>();
<a name="l00527"></a>00527   <a class="code" href="usbdrv_8h.html#a475d8622b0e0b64b65312970940c600e">usbDeviceConnect</a>();
<a name="l00528"></a>00528   <span class="comment">/* main event loop */</span>
<a name="l00529"></a>00529   <span class="keywordflow">for</span> (;;)
<a name="l00530"></a>00530   {
<a name="l00531"></a>00531     <span class="comment">//Watchdog</span>
<a name="l00532"></a>00532     wdt_reset();
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <span class="comment">//usb</span>
<a name="l00536"></a>00536 <span class="comment"></span>    <a class="code" href="usbdrv_8c.html#a188162c29eb62ffbd2d33763d20e12b4">usbPoll</a>();
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="comment">//IR Remote</span>
<a name="l00540"></a>00540 <span class="comment"></span>    ir_code = <a class="code" href="irrx_8h.html#aefd7d3a37ea0c9c112bbb819045fcea4">irrx_getcode</a>();
<a name="l00541"></a>00541     <span class="keywordflow">if</span> (ir_code != last_ir_code)
<a name="l00542"></a>00542     {
<a name="l00543"></a>00543       last_ir_code = ir_code;
<a name="l00544"></a>00544       ir_key_pressed = get_ir_key(ir_code);
<a name="l00545"></a>00545       <span class="keywordflow">if</span> (ir_key_pressed != 0)
<a name="l00546"></a>00546       {
<a name="l00547"></a>00547         <a class="code" href="main_8c.html#a95ee068e1e61fe45d00e66a1bfee85d1">LED_RED_ON</a>();
<a name="l00548"></a>00548       }
<a name="l00549"></a>00549       <span class="keywordflow">else</span>
<a name="l00550"></a>00550       {
<a name="l00551"></a>00551         <a class="code" href="main_8c.html#a327a94a460a470f29977db858d8074e1">LED_RED_OFF</a>();
<a name="l00552"></a>00552       }
<a name="l00553"></a>00553       <span class="keywordflow">if</span> (programming_mode_type &gt; <a class="code" href="main_8c.html#abc6126af1d45847bc59afa0aa3216b04abb79a6c34b3135862fdfb5192a9e1591">ProgramingMode_Not</a>)
<a name="l00554"></a>00554       {
<a name="l00555"></a>00555         <span class="keywordflow">if</span> (ir_code != <a class="code" href="irrx_8h.html#a9b37b956410016c9791cd56b63666f1f" title="No code received.">IRRX_NO_CODE</a>)
<a name="l00556"></a>00556         {
<a name="l00557"></a>00557           <span class="keywordflow">if</span> (ir_key_pressed == 0) <span class="comment">//Is key already programmed?</span>
<a name="l00558"></a>00558           {
<a name="l00559"></a>00559             <span class="comment">//No,</span>
<a name="l00560"></a>00560             ir_codes[programming_mode_type - 1] = ir_code;
<a name="l00561"></a>00561             fprintf_P(stdout,PSTR(<span class="stringliteral">&quot; 0x%04x\n&quot;</span>),ir_code);
<a name="l00562"></a>00562             programming_mode_type++;
<a name="l00563"></a>00563             print_button_label(programming_mode_type);
<a name="l00564"></a>00564             <span class="keywordflow">if</span> (programming_mode_type &gt;= <a class="code" href="main_8c.html#abc6126af1d45847bc59afa0aa3216b04af27abc9ca222c960254b211d99461e2b">ProgramingMode_LAST</a>)
<a name="l00565"></a>00565             {
<a name="l00566"></a>00566               eeprom_write_block(&amp;ir_codes, 0, <span class="keyword">sizeof</span>(ir_codes));
<a name="l00567"></a>00567               programming_mode_type = <a class="code" href="main_8c.html#abc6126af1d45847bc59afa0aa3216b04abb79a6c34b3135862fdfb5192a9e1591">ProgramingMode_Not</a>;
<a name="l00568"></a>00568             }
<a name="l00569"></a>00569           }
<a name="l00570"></a>00570           <span class="keywordflow">else</span>
<a name="l00571"></a>00571           {
<a name="l00572"></a>00572             <span class="comment">//Yes</span>
<a name="l00573"></a>00573             fprintf_P(stdout,PSTR(<span class="stringliteral">&quot;\n&quot;</span>));
<a name="l00574"></a>00574             print_button_label(programming_mode_type);
<a name="l00575"></a>00575           }
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577       }
<a name="l00578"></a>00578       <span class="keywordflow">else</span>
<a name="l00579"></a>00579       {
<a name="l00580"></a>00580         <span class="comment">//fprintf_P(stdout,PSTR(&quot;A&quot;));</span>
<a name="l00581"></a>00581         keyDidChange = <a class="code" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384eaa1297ee64a181eef334e50aaa88e8a5a">report_id_irremote</a>;
<a name="l00582"></a>00582       }
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <span class="comment">//Key presses</span>
<a name="l00587"></a>00587 <span class="comment"></span>    key = <a class="code" href="main_8c.html#a023283967eacb7889ae3819ba47cb2f8">SWITCH_PGM_IS_PRESSED</a>();
<a name="l00588"></a>00588     <span class="keywordflow">if</span> (lastKey != key)
<a name="l00589"></a>00589     {
<a name="l00590"></a>00590       <span class="keywordflow">if</span> (key)
<a name="l00591"></a>00591       {
<a name="l00592"></a>00592         <span class="keywordflow">if</span> (programming_mode_type == <a class="code" href="main_8c.html#abc6126af1d45847bc59afa0aa3216b04abb79a6c34b3135862fdfb5192a9e1591">ProgramingMode_Not</a>)
<a name="l00593"></a>00593         {
<a name="l00594"></a>00594           clear_ir_codes();
<a name="l00595"></a>00595           fprintf_P(stdout,PSTR(<span class="stringliteral">&quot;\nIR Keyboard (C) 2007 jorgen.birkler@gmail.com\n&quot;</span>));
<a name="l00596"></a>00596           print_button_label(programming_mode_type);
<a name="l00597"></a>00597           programming_mode_type++;
<a name="l00598"></a>00598           print_button_label(programming_mode_type);
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600         <span class="keywordflow">else</span>
<a name="l00601"></a>00601         {
<a name="l00602"></a>00602           programming_mode_type = <a class="code" href="main_8c.html#abc6126af1d45847bc59afa0aa3216b04abb79a6c34b3135862fdfb5192a9e1591">ProgramingMode_Not</a>;
<a name="l00603"></a>00603           <a class="code" href="main_8c.html#a327a94a460a470f29977db858d8074e1">LED_RED_OFF</a>();
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605       }
<a name="l00606"></a>00606       lastKey = key;
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608     <span class="comment">//Virtual keyboard (printf)</span>
<a name="l00610"></a>00610 <span class="comment"></span>    <span class="keywordflow">if</span> (virtual_keyboard_buffer_not_empty() &amp;&amp; virtual_keyboard_timer == 0)
<a name="l00611"></a>00611     {
<a name="l00612"></a>00612       virtual_keyboard_timer = 3;
<a name="l00613"></a>00613     }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="comment">//USB interrupt</span>
<a name="l00617"></a>00617 <span class="comment"></span>    <span class="keywordflow">if</span> (keyDidChange &amp;&amp; <a class="code" href="usbdrv_8h.html#a1f6b221fb650a7575d4937e37956181d">usbInterruptIsReady</a>())
<a name="l00618"></a>00618     {
<a name="l00619"></a>00619       <span class="comment">/* use last key and not current key status in order to avoid lost changes in key status. */</span>
<a name="l00620"></a>00620       buildReport(keyDidChange, ir_key_pressed, vtLastKey);
<a name="l00621"></a>00621       <a class="code" href="usbdrv_8h.html#aafa474a799eed02d362bfdfb8a36602c">usbSetInterrupt</a>(reportBuffer, <span class="keyword">sizeof</span>(reportBuffer));
<a name="l00622"></a>00622       keyDidChange = 0;
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="comment">//Timer</span>
<a name="l00627"></a>00627 <span class="comment"></span>
<a name="l00628"></a>00628     <span class="keywordflow">if</span> (TIFR &amp; _BV(TOV0))
<a name="l00629"></a>00629     {
<a name="l00630"></a>00630       <span class="comment">/* 22 ms timer */</span>
<a name="l00631"></a>00631       TIFR = 1&lt;&lt;TOV0;
<a name="l00632"></a>00632       <span class="keywordflow">if</span> (programming_mode_type != <a class="code" href="main_8c.html#abc6126af1d45847bc59afa0aa3216b04abb79a6c34b3135862fdfb5192a9e1591">ProgramingMode_Not</a>)
<a name="l00633"></a>00633       {
<a name="l00634"></a>00634         <span class="keywordflow">if</span> (blink_timer == 0)
<a name="l00635"></a>00635         {
<a name="l00636"></a>00636           <a class="code" href="main_8c.html#a5bbf7f30820f080616be89266fbcf129">LED_RED_CHANGE</a>();
<a name="l00637"></a>00637           blink_timer = <a class="code" href="main_8c.html#a950e6c73a7a60c02d5ddf48d538ca2c1">BLINK_TIMER_TIMEOUT</a>;
<a name="l00638"></a>00638         }
<a name="l00639"></a>00639         blink_timer--;
<a name="l00640"></a>00640       }
<a name="l00641"></a>00641       <span class="keywordflow">if</span> (virtual_keyboard_timer &gt; 0)
<a name="l00642"></a>00642       {
<a name="l00643"></a>00643         virtual_keyboard_timer--;
<a name="l00644"></a>00644         <span class="keywordflow">if</span> (virtual_keyboard_timer == 1)
<a name="l00645"></a>00645         {
<a name="l00646"></a>00646           vtLastKey = 0;
<a name="l00647"></a>00647           keyDidChange = <a class="code" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384eaf94c3c43a4d7295e2a888777fcfc4c87">report_id_virtualkeyboard</a>;
<a name="l00648"></a>00648         }
<a name="l00649"></a>00649         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (virtual_keyboard_timer == 0)
<a name="l00650"></a>00650         {
<a name="l00651"></a>00651           keyDidChange = <a class="code" href="main_8c.html#adc4a49de71d98fba3ecc94fb4023384eaf94c3c43a4d7295e2a888777fcfc4c87">report_id_virtualkeyboard</a>;
<a name="l00652"></a>00652           vtLastKey
<a name="l00653"></a>00653               = virtual_keyboard_translate_to_hid(virtual_keyboard_iogetchar());
<a name="l00654"></a>00654           <span class="keywordflow">if</span> (vtLastKey != 0)
<a name="l00655"></a>00655           {
<a name="l00656"></a>00656             virtual_keyboard_timer = 2;
<a name="l00657"></a>00657           }
<a name="l00658"></a>00658         }
<a name="l00659"></a>00659       }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661       <span class="keywordflow">if</span> (ir_timer &gt; 0)
<a name="l00662"></a>00662       {
<a name="l00663"></a>00663         ir_timer--;
<a name="l00664"></a>00664         <span class="keywordflow">if</span> (ir_timer == 0)
<a name="l00665"></a>00665         {
<a name="l00666"></a>00666           <a class="code" href="main_8c.html#a327a94a460a470f29977db858d8074e1">LED_RED_OFF</a>();
<a name="l00667"></a>00667           <a class="code" href="main_8c.html#a644339948c77e66e185ba6fc33501f39">LED_GREEN_OFF</a>();
<a name="l00668"></a>00668           ir_key_pressed = 0;
<a name="l00669"></a>00669           ir_code = <a class="code" href="irrx_8h.html#a9b37b956410016c9791cd56b63666f1f" title="No code received.">IRRX_NO_CODE</a>;
<a name="l00670"></a>00670           keyDidChange = 1;
<a name="l00671"></a>00671         }
<a name="l00672"></a>00672       }
<a name="l00673"></a>00673       <span class="keywordflow">if</span> (idleRate != 0)
<a name="l00674"></a>00674       {
<a name="l00675"></a>00675         <span class="keywordflow">if</span> (idleCounter &gt; 4)
<a name="l00676"></a>00676         {
<a name="l00677"></a>00677           idleCounter -= 5; <span class="comment">/* 22 ms in units of 4 ms */</span>
<a name="l00678"></a>00678         }
<a name="l00679"></a>00679         <span class="keywordflow">else</span>
<a name="l00680"></a>00680         {
<a name="l00681"></a>00681           idleCounter = idleRate;
<a name="l00682"></a>00682           <span class="comment">//keyDidChange = 1;</span>
<a name="l00683"></a>00683         }
<a name="l00684"></a>00684       }
<a name="l00685"></a>00685     }
<a name="l00686"></a>00686   }
<a name="l00687"></a>00687   <span class="keywordflow">return</span> 0;
<a name="l00688"></a>00688 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab22a701c31350c87bafb03abccd8c2f0"></a><!-- doxytag: member="main.c::STATIC_ASSERT" ref="ab22a701c31350c87bafb03abccd8c2f0" args="(sizeof(usbHidReportDescriptor)==USB_CFG_HID_REPORT_DESCRIPTOR_LENGTH)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="main_8c.html#a4bc2493b9488cbfb5bf35651b8f5ccee">PROGMEM</a> STATIC_ASSERT </td>
          <td>(</td>
          <td class="paramtype">sizeof(usbHidReportDescriptor)&nbsp;</td>
          <td class="paramname"> = <code>=USB_CFG_HID_REPORT_DESCRIPTOR_LENGTH</code></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af37eb5fa0cb81fc3eadda2e452573c58"></a><!-- doxytag: member="main.c::STATIC_ASSERT" ref="af37eb5fa0cb81fc3eadda2e452573c58" args="(sizeof(virtual_keyboard_buffer.data)==128||sizeof(virtual_keyboard_buffer.data)==256||sizeof(virtual_keyboard_buffer.data)==64)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC_ASSERT </td>
          <td>(</td>
          <td class="paramtype">sizeof(virtual_keyboard_buffer.data)&nbsp;</td>
          <td class="paramname"> = <code>=128||sizeof(virtual_keyboard_buffer.data)==256||sizeof(virtual_keyboard_buffer.data)==64</code></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ae6f351eca7bf6fb1251f9a478cbae2b0"></a><!-- doxytag: member="main.c::usbFunctionSetup" ref="ae6f351eca7bf6fb1251f9a478cbae2b0" args="(uchar data[8])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uchar usbFunctionSetup </td>
          <td>(</td>
          <td class="paramtype">uchar&nbsp;</td>
          <td class="paramname"> <em>data</em>[8]</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00465">465</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00466"></a>00466 {
<a name="l00467"></a>00467   <a class="code" href="structusbRequest.html">usbRequest_t</a>* rq = (<span class="keywordtype">void</span> *)data;
<a name="l00468"></a>00468   <a class="code" href="usbdrv_8c.html#a5f78c8584830588b8c0c8f2a27772f8e">usbMsgPtr</a> = reportBuffer;
<a name="l00469"></a>00469   <span class="keywordflow">if</span>((rq-&gt;<a class="code" href="structusbRequest.html#a05c2e0d9ac30dce558bcd69a692314c0">bmRequestType</a> &amp; <a class="code" href="usbdrv_8h.html#aef7b9c4cc4266e79c677fd42e2abb40e">USBRQ_TYPE_MASK</a>) == <a class="code" href="usbdrv_8h.html#a5c5f92099964ea08cc8cf0bccb8ca4ed">USBRQ_TYPE_CLASS</a>)
<a name="l00470"></a>00470   {
<a name="l00471"></a>00471     <span class="comment">/* class request type */</span>
<a name="l00472"></a>00472     <span class="keywordflow">if</span>(rq-&gt;<a class="code" href="structusbRequest.html#a34c18b1dd0af60774cac48b176220c2c">bRequest</a> == <a class="code" href="usbdrv_8h.html#ab0c796905d6a7d0bfc605f8c3e252437">USBRQ_HID_GET_REPORT</a>)
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474       <span class="comment">/* wValue: ReportType (highbyte), ReportID (lowbyte) */</span>
<a name="l00475"></a>00475       <span class="comment">/* we only have one report type, so don&#39;t look at wValue */</span>
<a name="l00476"></a>00476       buildReport(rq-&gt;<a class="code" href="structusbRequest.html#ab3f8687bb757c53ed03c3ce4310dc5c5">wValue</a>.<a class="code" href="unionusbWord.html#a3efd0ec82e53de09193e9de269434334">bytes</a>[0],ir_key_pressed,vtLastKey);
<a name="l00477"></a>00477       <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(reportBuffer);
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(rq-&gt;<a class="code" href="structusbRequest.html#a34c18b1dd0af60774cac48b176220c2c">bRequest</a> == <a class="code" href="usbdrv_8h.html#aebf7c3254b56413d7679b89bb99e144c">USBRQ_HID_GET_IDLE</a>)
<a name="l00480"></a>00480     {
<a name="l00481"></a>00481       <a class="code" href="usbdrv_8c.html#a5f78c8584830588b8c0c8f2a27772f8e">usbMsgPtr</a> = &amp;idleRate;
<a name="l00482"></a>00482       <span class="keywordflow">return</span> 1;
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(rq-&gt;<a class="code" href="structusbRequest.html#a34c18b1dd0af60774cac48b176220c2c">bRequest</a> == <a class="code" href="usbdrv_8h.html#a0d7b2ebb28c23a8bd2fb4a630b85ad71">USBRQ_HID_SET_IDLE</a>)
<a name="l00485"></a>00485     {
<a name="l00486"></a>00486       idleRate = rq-&gt;<a class="code" href="structusbRequest.html#ab3f8687bb757c53ed03c3ce4310dc5c5">wValue</a>.<a class="code" href="unionusbWord.html#a3efd0ec82e53de09193e9de269434334">bytes</a>[1];
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488   }
<a name="l00489"></a>00489   <span class="keywordflow">else</span>
<a name="l00490"></a>00490   {
<a name="l00491"></a>00491     <span class="comment">/* no vendor specific requests implemented */</span>
<a name="l00492"></a>00492   }
<a name="l00493"></a>00493   <span class="keywordflow">return</span> 0;
<a name="l00494"></a>00494 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a4bc2493b9488cbfb5bf35651b8f5ccee"></a><!-- doxytag: member="main.c::PROGMEM" ref="a4bc2493b9488cbfb5bf35651b8f5ccee" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PGM_P button_labels [] <a class="el" href="main_8c.html#a4bc2493b9488cbfb5bf35651b8f5ccee">PROGMEM</a> = &quot;Press button\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="main_8c_source.html#l00335">335</a> of file <a class="el" href="main_8c_source.html">main.c</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>
Generated on Mon Jun 7 18:44:12 2010 for USB IR HID Device by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen.org</a> 1.6.3</small></address>
</body>
</html>
